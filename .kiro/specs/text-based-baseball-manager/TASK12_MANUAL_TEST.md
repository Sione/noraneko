# タスク12: 試合履歴と戦績管理 - マニュアルテスト手順書

## 概要

タスク12「試合履歴と戦績管理」の実装を手動でテストするための手順書です。各機能が正しく動作することを確認します。

## 前提条件

- フロントエンドサーバーが起動していること (`npm run dev`)
- ブラウザのlocalStorageが有効であること
- タスク10までの実装が完了していること

## テスト環境

- ブラウザ: Chrome, Firefox, Safari
- 画面サイズ: デスクトップ、タブレット、モバイル

---

## テストケース1: 試合結果の保存

### 目的
試合終了時に結果が自動的に保存されることを確認する。

### 手順
1. `/baseball`にアクセス
2. 新規試合を開始する
3. 試合を最後まで進行させる（9回終了まで）
4. 試合終了画面が表示される

### 確認項目
- [ ] 試合終了画面に「試合結果を保存しました」というメッセージが表示される（緑色）
- [ ] メッセージが5秒後に自動的に消える
- [ ] ブラウザのDevToolsでlocalStorageを確認し、`baseball_game_history`キーにデータが保存されている
- [ ] 保存されたJSONデータに`gameId`、`date`、`score`、`highlights`などが含まれている

### 期待結果
- 試合結果が正しくlocalStorageに保存される
- 保存成功メッセージが表示される

---

## テストケース2: 履歴一覧の表示

### 目的
保存された試合が履歴一覧に表示されることを確認する。

### 手順
1. テストケース1を完了させる（少なくとも1試合を保存）
2. 試合終了画面で「試合履歴を見る」ボタンをクリック
3. `/baseball/history`に遷移する

### 確認項目
- [ ] 履歴一覧画面が表示される
- [ ] 保存した試合が新しい順に表示される
- [ ] 各試合に以下の情報が表示される:
  - [ ] 日付
  - [ ] 対戦相手
  - [ ] スコア（ホーム - アウェイ）
  - [ ] 結果（勝/敗/分）
  - [ ] 試合時間
  - [ ] イニング数
- [ ] 勝利試合は緑色の左ボーダー
- [ ] 敗北試合は赤色の左ボーダー
- [ ] サヨナラゲームには「サヨナラ」バッジが表示される
- [ ] 延長戦には「延長」バッジが表示される

### 期待結果
- 試合が見やすく表示される
- 色分けが正しく機能する

---

## テストケース3: 通算成績の表示

### 目的
通算成績が正しく計算されて表示されることを確認する。

### 手順
1. 複数の試合を実施する（少なくとも3試合：2勝1敗など）
2. `/baseball/history`にアクセス

### 確認項目
- [ ] 「通算成績」セクションが表示される
- [ ] 以下の情報が正しく表示される:
  - [ ] 試合数（総試合数）
  - [ ] 勝利数
  - [ ] 敗北数
  - [ ] 引分数
  - [ ] 勝率（小数点第3位まで）
  - [ ] 平均得点
  - [ ] 平均失点
  - [ ] 最多連勝
- [ ] 現在連勝中の場合、「現在の連勝: N」が表示される
- [ ] 現在連敗中の場合、「現在の連敗: N」が表示される

### 期待結果
- 勝率が正しく計算される（例: 2勝1敗 → 0.667）
- 連勝/連敗が正しく追跡される

---

## テストケース4: 最近の成績表示

### 目的
最近10試合の成績が正しく表示されることを確認する。

### 手順
1. 10試合以上の試合を実施する
2. `/baseball/history`にアクセス

### 確認項目
- [ ] 「最近10試合」セクションが表示される
- [ ] 以下の情報が表示される:
  - [ ] 勝敗数（例: 7勝3敗）
  - [ ] 勝率
  - [ ] 平均得点
  - [ ] 平均失点
- [ ] 最近10試合のみが計算対象になっている

### 期待結果
- 最近の成績が正しく表示される

---

## テストケース5: ページネーション

### 目的
ページネーションが正しく機能することを確認する。

### 手順
1. 15試合以上の試合を実施する
2. `/baseball/history`にアクセス

### 確認項目
- [ ] 最初のページに10試合が表示される
- [ ] ページネーションが表示される（「1 / 2 ページ」など）
- [ ] 「次へ」ボタンをクリックすると2ページ目に移動する
- [ ] 2ページ目に残りの試合が表示される
- [ ] 「前へ」ボタンをクリックすると1ページ目に戻る
- [ ] 最初のページでは「前へ」ボタンが無効化される
- [ ] 最後のページでは「次へ」ボタンが無効化される

### 期待結果
- ページネーションが正しく機能する
- ボタンの無効化が適切

---

## テストケース6: 試合詳細の表示

### 目的
試合詳細画面が正しく表示されることを確認する。

### 手順
1. `/baseball/history`にアクセス
2. 任意の試合をクリック
3. `/baseball/history/:gameId`に遷移する

### 確認項目
- [ ] 試合詳細画面が表示される
- [ ] 以下の情報が表示される:
  - [ ] 日付と時刻
  - [ ] 試合タイプ（通常試合/サヨナラゲーム/延長戦/コールドゲーム）
  - [ ] 最終スコア（大きく表示）
  - [ ] 勝敗結果（勝利/敗北/引き分け）
  - [ ] 試合時間
  - [ ] 最終イニング
- [ ] MVP情報が表示される（存在する場合）
- [ ] イニング別スコア表が表示される
  - [ ] 各イニングの得点
  - [ ] 合計点
- [ ] 試合統計表が表示される
  - [ ] 安打数
  - [ ] エラー数
  - [ ] 残塁数

### 期待結果
- 試合情報が詳細に表示される
- レイアウトが見やすい

---

## テストケース7: ハイライト表示

### 目的
試合のハイライトが正しく表示されることを確認する。

### 手順
1. 得点シーン、本塁打、投手交代などがある試合を実施する
2. その試合の詳細画面にアクセス

### 確認項目
- [ ] 「ハイライト」セクションが表示される
- [ ] 重要プレイが時系列で表示される
- [ ] 各ハイライトに以下が含まれる:
  - [ ] イニング情報（例: 3回表）
  - [ ] プレイの説明
- [ ] ハイライトが青色の左ボーダーで強調される

### 期待結果
- 重要プレイが見やすく表示される

---

## テストケース8: プレイログ表示

### 目的
試合の全プレイログが正しく表示されることを確認する。

### 手順
1. 任意の試合の詳細画面にアクセス

### 確認項目
- [ ] 「プレイログ」セクションが表示される
- [ ] 全プレイが時系列で表示される
- [ ] 各プレイに以下が含まれる:
  - [ ] イニング情報（例: 1回表）
  - [ ] プレイの説明
- [ ] 初期状態では400pxまで表示され、それ以上はスクロール可能
- [ ] 「すべて表示」ボタンをクリックすると全ログが展開される
- [ ] 「折りたたむ」ボタンをクリックすると元に戻る

### 期待結果
- 全プレイログが閲覧可能
- 折りたたみ機能が正しく動作

---

## テストケース9: 期間フィルタ

### 目的
期間フィルタが正しく機能することを確認する。

### 手順
1. 複数の日付にまたがる試合を実施する（過去7日以内、過去30日以内、それ以前など）
2. `/baseball/history`にアクセス
3. 期間フィルタを変更する

### 確認項目
- [ ] 期間フィルタのドロップダウンが表示される
- [ ] 以下のオプションが選択可能:
  - [ ] 全期間
  - [ ] 過去7日間
  - [ ] 過去30日間
- [ ] 「過去7日間」を選択すると、過去7日以内の試合のみが表示される
- [ ] 「過去30日間」を選択すると、過去30日以内の試合のみが表示される
- [ ] フィルタ適用後、通算成績が再計算される
- [ ] 「表示中: N試合 / 全M試合」が正しく更新される

### 期待結果
- 期間フィルタが正しく機能する
- 成績が再計算される

---

## テストケース10: 勝敗フィルタ

### 目的
勝敗フィルタが正しく機能することを確認する。

### 手順
1. 勝利、敗北、引き分けの試合を複数実施する
2. `/baseball/history`にアクセス
3. 勝敗フィルタを変更する

### 確認項目
- [ ] 勝敗フィルタのドロップダウンが表示される
- [ ] 以下のオプションが選択可能:
  - [ ] すべて
  - [ ] 勝利のみ
  - [ ] 敗北のみ
  - [ ] 引分のみ
- [ ] 「勝利のみ」を選択すると、勝利試合のみが表示される
- [ ] 「敗北のみ」を選択すると、敗北試合のみが表示される
- [ ] 「引分のみ」を選択すると、引分試合のみが表示される
- [ ] フィルタ適用後、通算成績が再計算される

### 期待結果
- 勝敗フィルタが正しく機能する
- 成績が再計算される

---

## テストケース11: 複数フィルタの組み合わせ

### 目的
複数のフィルタを組み合わせて使用できることを確認する。

### 手順
1. `/baseball/history`にアクセス
2. 期間フィルタを「過去7日間」に設定
3. 勝敗フィルタを「勝利のみ」に設定

### 確認項目
- [ ] 両方のフィルタが同時に適用される
- [ ] 過去7日間の勝利試合のみが表示される
- [ ] 通算成績が正しく再計算される

### 期待結果
- 複数フィルタが正しく動作する

---

## テストケース12: データの永続化

### 目的
ブラウザをリロードしてもデータが保持されることを確認する。

### 手順
1. 複数の試合を実施して保存する
2. ブラウザをリロード（F5）する
3. `/baseball/history`にアクセス

### 確認項目
- [ ] リロード後も試合履歴が表示される
- [ ] 通算成績が保持されている
- [ ] 最近の成績が保持されている

### 期待結果
- データがlocalStorageに永続化されている

---

## テストケース13: 自動圧縮

### 目的
100試合を超えた場合、古い試合が自動削除されることを確認する。

### 手順
1. 101試合の試合を実施する（自動化スクリプトを使用するか、手動で）
2. `/baseball/history`にアクセス

### 確認項目
- [ ] 履歴一覧に100試合のみが表示される
- [ ] 最も古い試合が削除されている
- [ ] 通算成績が正しく計算される

### 期待結果
- 最大100試合のみが保存される

---

## テストケース14: 戻る機能

### 目的
画面間の遷移が正しく動作することを確認する。

### 手順
1. `/baseball/history`にアクセス
2. 任意の試合をクリックして詳細画面に移動
3. 「履歴一覧に戻る」ボタンをクリック

### 確認項目
- [ ] 詳細画面から一覧画面に戻れる
- [ ] ブラウザの戻るボタンでも戻れる
- [ ] 試合終了画面から「試合履歴を見る」ボタンで履歴画面に遷移できる
- [ ] 履歴画面から「メインメニューに戻る」ボタンで野球ゲームのトップに戻れる

### 期待結果
- 画面遷移が正しく動作する

---

## テストケース15: レスポンシブデザイン

### 目的
様々な画面サイズで正しく表示されることを確認する。

### 手順
1. ブラウザの幅を変更する
   - デスクトップ（1200px以上）
   - タブレット（768px～1200px）
   - モバイル（768px以下）

### 確認項目
- [ ] デスクトップで全要素が見やすく表示される
- [ ] タブレットでレイアウトが適切に調整される
- [ ] モバイルで以下が適切に表示される:
  - [ ] テーブルが横スクロール可能
  - [ ] 通算成績が2カラムで表示
  - [ ] フィルタが縦に並ぶ
  - [ ] ボタンが適切なサイズ

### 期待結果
- 全画面サイズで使いやすい

---

## テストケース16: エラーハンドリング

### 目的
エラーが適切にハンドリングされることを確認する。

### 手順
1. ブラウザのDevToolsでlocalStorageの`baseball_game_history`キーに不正なJSONを設定
2. ページをリロード

### 確認項目
- [ ] エラーメッセージが表示される（コンソールに）
- [ ] 空の履歴画面が表示される
- [ ] 「試合履歴がありません」というメッセージが表示される
- [ ] アプリケーションがクラッシュしない

### 期待結果
- 不正なデータでもアプリが正常に動作する

---

## テストケース17: 存在しない試合へのアクセス

### 目的
存在しないgameIdでアクセスした場合のエラーハンドリングを確認する。

### 手順
1. `/baseball/history/invalid-game-id`に直接アクセス

### 確認項目
- [ ] 「試合データが見つかりません」というメッセージが表示される
- [ ] 「履歴一覧に戻る」ボタンが表示される
- [ ] ボタンをクリックすると履歴一覧に戻れる

### 期待結果
- 適切なエラーメッセージが表示される

---

## 回帰テスト

### 既存機能への影響確認

以下の既存機能が引き続き動作することを確認する:

- [ ] 試合の開始と進行
- [ ] 試合終了判定
- [ ] MVP表示
- [ ] イニング別スコア表示
- [ ] 個人成績表示
- [ ] メインメニューへの遷移

---

## パフォーマンステスト

### 大量データでの動作確認

1. 100試合の履歴データを作成
2. 各画面の動作を確認

### 確認項目
- [ ] 履歴一覧の表示が3秒以内
- [ ] フィルタの適用が1秒以内
- [ ] ページ切り替えが即座に反応
- [ ] スクロールが滑らか

---

## ブラウザ互換性テスト

以下のブラウザで全機能が動作することを確認:

- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）

---

## 完了条件

- 全テストケースがパスする
- 致命的なバグが存在しない
- パフォーマンスが許容範囲内
- 主要ブラウザで動作する

---

## 不具合報告テンプレート

不具合を発見した場合、以下のフォーマットで報告してください:

```
## 不具合概要
[不具合の簡潔な説明]

## 再現手順
1. [手順1]
2. [手順2]
3. [手順3]

## 期待される動作
[期待される結果]

## 実際の動作
[実際に起こった結果]

## 環境
- ブラウザ: [Chrome 120.0.0.0]
- OS: [macOS 14.0]
- 画面サイズ: [1920x1080]

## スクリーンショット
[可能であればスクリーンショットを添付]
```

---

## テスト完了後の確認

全テストが完了したら、以下を確認してください:

- [ ] 全テストケースの結果を記録
- [ ] 発見された不具合をIssueとして登録
- [ ] テスト結果をレポートとしてまとめる
- [ ] 次のタスクへ進む準備ができている
