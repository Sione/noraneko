# 実装タスク

- [ ] 1. 試合開始と基本フローの確立
- [ ] 1.1 (P) 試合初期化と開始の画面遷移
  - メインメニューから対戦チーム選択へ遷移できるようにする
  - ホーム/ビジター選択と初期スコアを反映する
  - 試合開始メッセージと先発設定を表示する
  - _Requirements: 1_

- [ ] 1.2 イニング進行と攻守交代
  - イニング/表裏/攻守の表示を更新する
  - 打順開始とアウト3での交代処理を行う
  - イニング間のスコア更新を反映する
  - _Requirements: 1_

- [ ] 1.3 試合終了条件と終了演出
  - 9回・延長・コールド・サヨナラの終了条件を判定する
  - 引き分け時の終了と試合時間の表示を行う
  - _Requirements: 1_

- [x] 2. 監督指示システムの実装
- [x] 2.1 (P) 攻撃指示メニューと有効条件
  - 打席開始時に基本指示を提示する
  - 走者状況に応じた追加指示を切り替える
  - 無効指示の警告と再提示を行う
  - _Requirements: 2_

- [x] 2.2 (P) 守備指示メニューと投手/シフト操作
  - 守備ターンで指示メニューを表示する
  - 投手交代時に候補と疲労情報を提示する
  - 敬遠と守備シフトの実行を反映する
  - _Requirements: 2_

- [ ] 2.3 指示制限とフィードバック
  - 2ストライク/ツーアウト/走力差の警告を表示する
  - 指示実行と結果説明を実況で返す
  - 指示と結果を試合ログへ記録する
  - _Requirements: 2_

- [x] 3. 打席判定と確率計算の基礎
- [x] 3.1 投手対打者の一次判定
  - 乱数を用いた結果選択の骨格を作る
  - 三振/四球/インプレーの判定を能力値で計算する
  - 判定結果に応じて次段階へ遷移する
  - _Requirements: 3_

- [x] 3.2 打球種類/方向/強さの決定
  - ゴロ/フライ/ライナーの分布を計算する
  - 利き手と打球傾向で方向分布を調整する
  - 強さ判定と長打補正を適用する
  - _Requirements: 3_

- [x] 3.3 守備判定への接続とヒット種類決定
  - 守備判定へ渡す打球情報を整理する
  - ヒット種類の確定条件を評価する
  - _Requirements: 3_

- [x] 3.4 状態補正（疲労/コンディション/左右）
  - 投球数による疲労減衰を計算する
  - 打者コンディションの上下を反映する
  - 左右の組み合わせ補正を適用する
  - _Requirements: 3_

- [x] 4. 守備判定とアウト処理
- [x] 4.1 打球方向に基づく担当選手の特定
  - 守備位置と補助担当のルールを適用する
  - シフト適用時の処理条件を反映する
  - _Requirements: 3_

- [x] 4.2 ゴロ/フライ/ライナーの守備処理
  - 守備範囲・エラー・捕球判定を適用する
  - 内野/外野フライの分岐と結果処理を行う
  - ライナー特性の補正を適用する
  - _Requirements: 3_

- [x] 4.3 併殺/タッチアップ/送球選択
  - 併殺の2段階判定と失敗時の処理を行う
  - タッチアップの成功率を能力で評価する
  - 複数走者時の送球先選択を決定する
  - _Requirements: 3_

- [x] 4.4 守備エラー詳細と実況
  - エラー種別と進塁影響を判定する
  - 守備選手名を含む実況文を出力する
  - _Requirements: 3_

- [x] 5. バント/スクイズ判定
- [x] 5.1 バント打球の方向と処理
  - バント種類ごとの成功率を計算する
  - 打球方向と担当守備選手を決定する
  - 捕球/送球/到達時間を反映する
  - _Requirements: 3_

- [x] 5.2 犠打バントと進塁判定
  - 犠打成功時の進塁処理を行う
  - 守備側の狙い判断と封殺成否を評価する
  - _Requirements: 3_

- [x] 5.3 スクイズの判定
  - 打者/走者能力で成功率を計算する
  - 本塁送球の可否と結果を評価する
  - 成功/失敗時の得点処理を行う
  - _Requirements: 3_

- [x] 5.4 バント失敗の処理
  - バント失敗の結果種類を決定する
  - 2ストライク時の三振処理を適用する
  - _Requirements: 3_

- [x] 6. 走塁と進塁判定
- [x] 6.1 基本進塁ルール
  - 単打/二塁打/三塁打の進塁を確定する
  - 本塁打時の得点処理を行う
  - _Requirements: 3_

- [x] 6.2 単打時の本塁到達と追加進塁
  - 外野手送球と走者能力で本塁到達を判定する
  - 追加進塁の試行条件と成功率を評価する
  - _Requirements: 3_

- [x] 6.3 二塁打時の本塁到達と中継送球
  - 外野捕球位置に応じた判断を行う
  - 中継送球の段階的評価を行う
  - 送球先選択と悪送球時の処理を適用する
  - _Requirements: 3_

- [x] 6.4 得点と実況表示
  - 得点加算とスコア更新を行う
  - タイムリーやタッチアウトの実況を表示する
  - _Requirements: 3_

- [x] 7. 盗塁/ダブルスチール/エンドラン/牽制
- [x] 7.1 盗塁の試行判定
  - 走者・投手・捕手能力で成功率を計算する
  - 塁上守備選手の処理を評価する
  - _Requirements: 3_

- [x] 7.2 盗塁結果とダブルスチール
  - 成功/失敗の実況と結果処理を行う
  - ダブルスチールの送球選択と結果を評価する
  - _Requirements: 3_

- [x] 7.3 エンドラン判定
  - 打者結果に応じた走塁処理を行う
  - 成功時の実況と進塁増加を適用する
  - _Requirements: 3_

- [x] 7.4 牽制プレイ判定
  - 牽制試行確率とリード幅評価を行う
  - 牽制成功/悪送球の処理を適用する
  - _Requirements: 3_

- [ ] 8. 選手能力システムとチーム運用
- [ ] 8.1 (P) 能力値モデルと分類ロジック
  - 打撃/投球/走塁/守備の能力値を保持する
  - 打者/投手タイプ分類と左右補正を適用する
  - 能力値の影響範囲をゲーム判定に反映する
  - _Requirements: 4_

- [ ] 8.2 コンディションと疲労の影響
  - コンディション段階による能力補正を行う
  - 疲労度の管理と能力減衰を適用する
  - _Requirements: 4_

- [ ] 8.3 (P) 打順・ロースター運用
  - 先発/ベンチ構成と打順編集を提供する
  - 推奨打順の自動生成を行う
  - _Requirements: 4_

- [ ] 8.4 試合中の選手表示
  - 打者/投手の主要能力と成績を表示する
  - 左右の組み合わせ表示と投球数表示を行う
  - _Requirements: 4_

- [ ] 8.5 交代ルールの適用
  - 代打/守備固めの選択と反映を行う
  - 再出場不可とDHルールを適用する
  - _Requirements: 4_

- [ ] 8.6 (P) 能力値の可視化と総合評価
  - 能力値の色分け表示を行う
  - 総合評価の自動計算を実装する
  - 試合中成績の更新と保存を行う
  - _Requirements: 4_

- [ ] 9. 試合状況の可視化
- [ ] 9.1 (P) スコアボードとイニング表示
  - 得点/イニング/アウト/カウントを常時表示する
  - イニング別得点表と打順位置を表示する
  - _Requirements: 5_

- [ ] 9.2 (P) 塁上ランナー表示
  - 塁状況の可視化と選手名表示を行う
  - 進塁/得点時に視覚的更新を行う
  - _Requirements: 5_

- [ ] 9.3 実況とプレイ結果表示
  - 打席の流れと結果を実況表示する
  - 重要プレイを強調表示する
  - _Requirements: 5_

- [ ] 9.4 (P) 重要局面とガイダンス表示
  - 得点圏/接戦/サヨナラ機会のラベルを表示する
  - 次の操作を示すガイドを常時表示する
  - _Requirements: 5_

- [ ] 9.5 (P) プレイログと履歴表示
  - プレイ履歴を時系列で保存し表示する
  - イニング単位のフィルタを提供する
  - ログ件数制限と圧縮を適用する
  - _Requirements: 5_

- [ ] 9.6 (P) UIレイアウトと情報整理
  - レスポンシブレイアウトを適用する
  - 情報量過多時の折りたたみ/モーダルを提供する
  - _Requirements: 5_

- [x] 10. 勝敗判定と試合終了処理
- [x] 10.1 通常終了時の勝敗判定
  - 9回終了条件と勝敗表示を行う
  - 最終スコアと成績サマリーを表示する
  - _Requirements: 6_

- [x] 10.2 延長/サヨナラ/コールドの判定
  - 延長開始と回数表示を行う
  - サヨナラ条件と即時終了を適用する
  - コールド/ノーゲームの扱いを反映する
  - _Requirements: 6_

- [x] 10.3 試合終了後の保存と次アクション
  - 試合結果を保存し次の選択肢を提示する
  - MVP/ハイライト表示オプションを提供する
  - 集計値と個人成績を確定する
  - _Requirements: 6_

- [ ] 11. エラーハンドリングとユーザビリティ
- [ ] 11.1 (P) 入力エラー対応
  - 無効指示の理由を説明し再選択させる
  - エラー時に状態を維持し視覚的警告を表示する
  - _Requirements: 7_

- [ ] 11.2 (P) システムエラーと自動保存
  - 例外時の緊急保存とエラーログを記録する
  - 再起動時の復旧確認ダイアログを表示する
  - _Requirements: 7_

- [ ] 11.3 中断/再開フロー
  - 一時停止メニューと保存/終了を提供する
  - 再開時に試合状態を復元する
  - _Requirements: 7_

- [ ] 11.4 (P) 操作ガイドとヘルプ
  - 指示オプションの説明を付与する
  - チュートリアル/ヘルプをモーダルで表示する
  - _Requirements: 7_

- [ ] 11.5 レスポンスと表示テンポ
  - 操作受付の即時反映と応答時間を維持する
  - テキスト速度と続行ボタンを制御する
  - _Requirements: 7_

- [ ] 11.6 (P) アクセシビリティとカスタマイズ
  - 表示言語/テーマ/難易度の設定を提供する
  - 設定を保存して次回起動に反映する
  - _Requirements: 7_

- [ ] 12. 試合履歴と戦績管理
- [ ] 12.1 (P) 試合結果の保存
  - 試合結果とハイライトを永続化する
  - 保存完了メッセージを表示する
  - _Requirements: 8_

- [ ] 12.2 (P) 履歴一覧の表示
  - 履歴一覧を新しい順に表示する
  - ページネーション/スクロールを提供する
  - _Requirements: 8_

- [ ] 12.3 (P) 履歴詳細とログ
  - 試合詳細画面を表示する
  - プレイ履歴の詳細ログを表示する
  - _Requirements: 8_

- [ ] 12.4 (P) 通算成績の集計
  - 勝率や自己ベストを計算して表示する
  - 戦績サマリーを見やすく表示する
  - _Requirements: 8_

- [ ] 12.5 (P) フィルタと検索
  - 期間/勝敗/対戦相手のフィルタを実装する
  - フィルタ後の再集計を反映する
  - _Requirements: 8_

- [ ] 12.6 (P) データ永続化と復元
  - 起動時に履歴データを復元する
  - 破損時のエラーメッセージと初期化を行う
  - _Requirements: 8_

- [ ] 12.7 (P) 履歴削除と圧縮
  - 削除前の確認と警告を表示する
  - 古いログの圧縮オプションを提供する
  - _Requirements: 8_

- [ ] 12.8 (P) トレンド分析とグラフ
  - 最近の成績と得失点を集計表示する
  - グラフ/ランキングを表示する
  - _Requirements: 8_

- [ ] 13. 選手・チームデータ管理
- [ ] 13.1 (P) デフォルト選手データのロード
  - 初回起動時のデータロードと検証を行う
  - エラー時の詳細表示とスキップ処理を行う
  - _Requirements: 9_

- [ ] 13.2 (P) 選手詳細表示
  - 能力値一覧と色分け表示を行う
  - 詳細画面の操作ボタンを提供する
  - _Requirements: 9_

- [ ] 13.3 (P) 選手の新規作成
  - 作成フォームと必須項目入力を提供する
  - 能力値変更時に総合評価を更新する
  - 保存時の検証と確認メッセージを表示する
  - _Requirements: 9_

- [ ] 13.4 (P) 選手の編集
  - 既存データを入力済みで表示する
  - 変更差分と確認ダイアログを表示する
  - _Requirements: 9_

- [ ] 13.5 (P) 選手の削除
  - 削除確認と追加警告を表示する
  - 削除後の一覧復帰を行う
  - _Requirements: 9_

- [ ] 13.6 (P) チーム管理とロースター編集
  - チーム作成/編集のフォームを提供する
  - ロースター最小人数の検証を行う
  - _Requirements: 9_

- [ ] 13.7 (P) データのインポート/エクスポート
  - エクスポート対象の選択と保存を行う
  - インポートの検証と重複処理を行う
  - _Requirements: 9_

- [ ] 13.8 (P) テンプレートとバッチ編集
  - プリセット適用とテンプレート保存を提供する
  - バッチ編集の確認と結果表示を行う
  - _Requirements: 9_

- [ ] 13.9 (P) バックアップと整合性チェック
  - 自動バックアップと世代管理を行う
  - 破損検出時の復元処理を提供する
  - _Requirements: 9_

- [ ] 13.10 (P) ヘルプとサンプル提供
  - 能力値ガイドと操作ヘルプを表示する
  - サンプルデータの参照導線を提供する
  - _Requirements: 9_

- [ ] 14. CPU戦術AIの実装
- [ ] 14.1 基本AI判断と難易度
  - 攻守ターンに応じた判断フローを作る
  - 思考時間の演出と難易度補正を反映する
  - _Requirements: 10_

- [ ] 14.2 攻撃戦術の判断
  - 通常打撃/バント/盗塁/エンドラン/スクイズを選択する
  - 点差やカウントに応じた確率補正を適用する
  - _Requirements: 10_

- [ ] 14.3 守備戦術の判断
  - 投手交代の確率判断を行う
  - 敬遠と守備シフトの選択を決定する
  - _Requirements: 10_

- [ ] 15. 守備シフトシステム
- [ ] 15.1 (P) シフト種別と選択条件
  - シフト種別と基本補正を定義する
  - 推奨表示と変更制約を適用する
  - _Requirements: 11_

- [ ] 15.2 ゴロ打球への効果
  - シフト方向に応じた補正を計算する
  - 前進守備の本塁阻止補正を適用する
  - _Requirements: 11_

- [ ] 15.3 フライ/ライナー/長打への効果
  - 深守備/前進守備の補正を適用する
  - 逆方向打球と長打への影響を反映する
  - 特殊状況の補正を適用する
  - _Requirements: 11_

- [ ] 15.4 (P) シフトの演出と統計
  - シフト指示と結果を実況に反映する
  - 使用回数/成功率の統計を記録する
  - _Requirements: 11_

- [ ] 15.5 CPUシフトと戦術調整
  - CPUのシフト選択確率を難易度で調整する
  - 試合状況に応じた戦術調整と交代判断を適用する
  - AI判断の演出とログ出力を行う
  - _Requirements: 10, 11_

- [ ] 15.6 (P) AI委譲機能
  - AI委譲の選択肢と実行フローを用意する
  - 確認モード/常時委譲/難易度を設定できるようにする
  - ハイライト表示や手動復帰を提供する
  - _Requirements: 10_

- [ ] 15.7 (P) AI推奨表示と学習拡張
  - 一定時間無操作時のAI推奨を表示する
  - 推奨理由の表示と設定切替を提供する
  - 将来拡張の学習/適応フックを設ける
  - _Requirements: 10_
