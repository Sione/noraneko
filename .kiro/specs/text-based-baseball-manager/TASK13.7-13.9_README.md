# タスク13.7・13.9 実装概要

## 実装タスク
- **タスク13.7**: データのインポート/エクスポート
- **タスク13.9**: バックアップと整合性チェック

## 実装日
2026-02-02

## 概要

選手・チームデータの安全な管理と、柔軟なデータ交換を実現するための機能を実装しました。

### 主な機能

#### 1. エクスポート機能の強化
- **3つのエクスポート範囲**:
  - すべての選手
  - 特定のチーム
  - 選択した選手
- チーム情報の含有/除外の選択
- メタデータ（選手数、チーム数）の記録

#### 2. インポート機能の強化
- **3つの重複処理オプション**:
  - 上書き: 既存の選手を更新
  - スキップ: 既存の選手を保持
  - 名前変更: 新しいIDで追加（デフォルト）
- 能力値の厳密な検証（1-100範囲チェック）
- インポート前の自動バックアップ
- 詳細なエラーレポート

#### 3. バックアップ管理
- 手動バックアップの作成
- 自動バックアップ（1分間隔で制限）
- 最大10世代の管理
- バックアップからの復元
- 復元前のセーフティバックアップ
- バックアップの削除

#### 4. 整合性チェックの強化
- **エラー検出**:
  - 能力値の範囲外（1-100）
  - 存在しない選手への参照
  - ロースター/打順内の重複
- **警告検出**:
  - 孤立した選手（どのチームにも所属していない）
  - localStorage容量警告（80%以上）
- 詳細な統計情報の表示

## 新規ファイル

### コンポーネント
- `BackupManager.tsx` - バックアップ管理UI
- `BackupManager.css` - バックアップ管理スタイル
- `ImportExportDialog.tsx` - インポート/エクスポート詳細設定UI
- `ImportExportDialog.css` - ダイアログスタイル

### ドキュメント
- `TASK13.7-13.9_IMPLEMENTATION_REPORT.md` - 実装レポート
- `TASK13.7-13.9_MANUAL_TEST.md` - 手動テストガイド
- `TASK13.7-13.9_README.md` - このファイル

## 更新ファイル
- `playerStorage.ts` - データ永続化ロジックの強化
- `PlayerManagement.tsx` - 新しいUIコンポーネントの統合

## 使用方法

### エクスポート
1. 選手管理画面で「エクスポート」ボタンをクリック
2. エクスポート範囲を選択（全選手/チーム/選択した選手）
3. チーム情報を含めるか選択
4. 「エクスポート」ボタンでJSONファイルをダウンロード

### インポート
1. 選手管理画面で「インポート」ボタンをクリック
2. JSONファイルを選択
3. 重複処理オプションを選択
4. 能力値検証オプションを確認
5. 「インポート」ボタンで実行

### バックアップ管理
1. 選手管理画面で「バックアップ管理」ボタンをクリック
2. バックアップ一覧から操作:
   - 新しいバックアップを作成
   - バックアップを選択して詳細表示
   - 復元・削除・すべて削除

### 整合性チェック
1. 選手管理画面で「整合性チェック」ボタンをクリック
2. 結果メッセージを確認
3. エラーがある場合、開発者ツールのConsoleで詳細を確認

## テクニカルノート

### データフォーマット

#### エクスポートデータ
```json
{
  "version": "1.0",
  "exportedAt": "2026-02-02T12:00:00.000Z",
  "scope": "all",
  "players": [...],
  "teams": [...],
  "metadata": {
    "playerCount": 30,
    "teamCount": 2
  }
}
```

#### バックアップデータ
```json
{
  "timestamp": 1733126400000,
  "players": [...],
  "teams": [...]
}
```

### localStorage キー
- `baseball_custom_players`: 選手データ
- `baseball_custom_teams`: チームデータ
- `baseball_data_backup`: バックアップデータ（最大10世代）

### バリデーション

#### 必須フィールド
- `id`, `name`, `position`, `batterHand`
- `batting`, `running`, `fielding`

#### 能力値範囲
- すべての能力値: 1-100

#### 参照整合性
- チームのロースター: 実在する選手ID
- チームの打順: 実在する選手ID

## テスト

### 手動テスト
詳細なテストシナリオは `TASK13.7-13.9_MANUAL_TEST.md` を参照してください。

主要テスト項目:
- [ ] エクスポート（全選手/チーム/選択）
- [ ] インポート（重複処理）
- [ ] バックアップ（作成/復元/削除）
- [ ] 整合性チェック（エラー/警告検出）

### 推奨ユニットテスト
```typescript
// playerStorage.ts
- exportData()
- importData()
- createBackup()
- restoreFromBackup()
- checkDataIntegrity()
- validatePlayer()
- validatePlayerAbilities()
```

## トラブルシューティング

### エクスポート/インポートが動作しない
- ブラウザがJavaScriptを有効にしているか確認
- ファイルがJSON形式であることを確認
- 開発者ツールのConsoleでエラーを確認

### バックアップが作成されない
- localStorageが有効か確認（プライベートブラウジングモードでは無効）
- ストレージ容量を確認
- 開発者ツールのApplication > Local Storageを確認

### データが復元されない
- 正しいバックアップを選択しているか確認
- ページをリロード
- 最新のバックアップから復元を試す

## 今後の改善案

### 短期
1. CSV形式のサポート
2. インポート時のプレビュー機能
3. バックアップの圧縮

### 中期
1. クラウドストレージへのバックアップ
2. スケジュール自動バックアップ
3. 複数ファイルの一括インポート

### 長期
1. データの自動修復機能
2. バージョン管理とマイグレーション
3. データの差分バックアップ

## パフォーマンス

### メモリ使用量
- 選手100人: 約200KB
- バックアップ10世代: 約2MB

### 推奨事項
- 選手数が500人を超える場合は、定期的にバックアップを削除
- ストレージ使用率が80%を超えたら、古いデータを削除
- 大量インポート時は、能力値検証を無効化してパフォーマンスを向上

## 関連ドキュメント
- [実装レポート](./TASK13.7-13.9_IMPLEMENTATION_REPORT.md)
- [手動テストガイド](./TASK13.7-13.9_MANUAL_TEST.md)
- [デザインドキュメント](./design.md)
- [要件定義](./requirements.md)

## サポート
問題が発生した場合:
1. 手動テストガイドのトラブルシューティングセクションを確認
2. 開発者ツールのConsoleでエラーを確認
3. バックアップから復元を試行
4. 最新のバックアップが正常か確認

---

**実装完了**: 2026-02-02
**ステータス**: ✅ 完了
**テストステータス**: 🔄 手動テスト待ち
